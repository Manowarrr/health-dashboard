# План Разработки (Development Plan)

## 1. Анализ Вариантов Решения

Для MVP выбран монолитный подход на Next.js с использованием Supabase в качестве BaaS (Backend-as-a-Service).

- **Плюсы:**
    
    - **Скорость разработки:** Supabase предоставляет готовую БД, API, аутентификацию, избавляя от необходимости писать бэкенд с нуля.
        
    - **Единый язык:** Весь код пишется на TypeScript (фронтенд, серверные функции, бизнес-логика).
        
    - **Простота деплоя:** Легко разворачивается на Vercel.
        
    - **Масштабируемость:** Архитектура Next.js и Supabase хорошо масштабируется для будущих нужд.
        
- **Минусы:**
    
    - Зависимость от стороннего сервиса (Supabase).
        
- **Вывод:** Для MVP это оптимальный вариант, обеспечивающий максимальную скорость и простоту реализации.
    

## 2. Семантический Граф Функций (Верхнеуровневый)

```
<App>
    <AuthenticationLayer>
        <LoginComponent />
        <SupabaseClientAuth />
        <AuthMiddleware />
    </AuthenticationLayer>

    <DataEntryLayer>
        <AddDataModal>
            <AddDataFormComponent>
                <AddProductForm />
                <AddFoodLogForm />
                <AddWorkoutForm />
                <AddSleepLogForm />
                <!-- etc. -->
            </AddDataFormComponent>
        </AddDataModal>
    </DataEntryLayer>

    <PresentationLayer>
        <DashboardPage>
            <NutritionSummaryWidget />
            <WorkoutSummaryWidget />
            <SleepSummaryWidget />
            <!-- etc. -->
        </DashboardPage>
        <HistoryPage>
            <AnalyticsChart />
            <DataTable />
        </HistoryPage>
    </PresentationLayer>

    <BusinessLogicLayer (ServerActions)>
        <addProduct />
        <addFoodLog />
        <addWorkout />
        <getDailyNutritionSummary />
        <getMetricHistory />
        <!-- etc. -->
    </BusinessLogicLayer>

    <DatabaseLayer (Supabase)>
        <Tables (Products, FoodLog, Users, etc.) />
        <RLSPolicies />
        <Triggers />
    </DatabaseLayer>
</App>
```

## 3. Пошаговый Алгоритм Разработки

### **Этап 0: Настройка и Схема**

- **[DONE]** Инициализация проекта Next.js.
    
- **[DONE]** Настройка проекта Supabase.
    
- **[DONE]** Генерация и применение SQL-скрипта для создания схемы БД.
    

### **Этап 1: Фундамент и Аутентификация**

- **[DONE]** Интеграция Supabase SDK в Next.js (создание клиентов для сервера и клиента).
    
- **[DONE]** Настройка Middleware для защиты роутов.
    
- **[DONE]** Создание страницы входа (`/login`).
    
- **[DONE]** Настройка триггера в БД для автоматического создания профиля пользователя в таблице `users`.
    
- **[DONE]** Создание базового Layout для защищенной зоны (`/dashboard`).
    

### **Этап 2: Вертикальный срез "Питание"**


### **2.1. Навигация и Структура Раздела**

- **[DONE]** Обновить левую панель навигации:
    
    - Добавить основной пункт: **"Питание"**.
        
    - Добавить выпадающий список **"Справочники"**, внутри которого будут пункты:
        
        - **"Продукты"**
            
        - **"Рецепты"**
            

### **2.2. Страница "Справочник Продуктов" (`/dashboard/products`)**

- **[DONE]** Создание Server Action (`addProduct`) и UI-формы для **добавления** Продукта.
    
- **[TODO]** Разработка UI-компонентов страницы:
    
    - **Таблица продуктов:** Отображение списка всех продуктов с колонками (Название, Калории, БЖУ).
        
    - **Поиск и фильтрация:** Поле для поиска по названию.
        
    - **Кнопка "Добавить продукт":** Открывает существующее модальное окно для добавления.
        
    - **Элементы управления в строке:** Кнопки "Редактировать" и "Удалить" для каждого продукта.
        
- **[TODO]** Реализация Server Action (`updateProduct`) и модального окна для **редактирования** продукта.
    
- **[TODO]** Реализация Server Action (`deleteProduct`) и модального окна с подтверждением для **удаления** продукта.
    

### **2.3. Страница "Журнал Питания" (`/dashboard/nutrition`)**

- **[DONE]** Создание Server Actions (`getProducts`, `addFoodLog`) и UI-формы для логирования **Продукта**.
    
- **[TODO]** **Доработка формы добавления приема пищи:** Добавить поле для ввода **времени** (по умолчанию — текущее время).
    
- **[TODO]** Разработка UI-компонентов страницы:
    
    - **Календарь:** Компонент для выбора даты и навигации по дням.
        
    - **Список приемов пищи:** Отображение записей за выбранный день с указанием **точного времени** для каждой, сгруппированных по "Завтрак", "Обед", "Ужин", "Перекус".
        
    - **Редактирование записи:** Возможность изменить вес и **время** съеденного продукта/блюда.
        
    - **Удаление записи:** Кнопка для удаления записи из журнала.
        
- **[TODO]** Создание Server Action (`updateFoodLogEntry`) для обновления записи в журнале (включая `logged_at`).
    
- **[TODO]** Создание Server Action (`deleteFoodLogEntry`) для удаления записи.
    

### **2.4. Конструктор Рецептов (Страница `/dashboard/recipes`)**

- **[TODO] [DB]** Модификация схемы БД: добавить таблицы `recipes` и `recipe_products`.
    
- **[TODO]** Создание UI-страницы (`/dashboard/recipes`) для отображения и управления рецептами.
    
- **[TODO]** Разработка UI "Конструктора Рецептов".
    
- **[TODO]** Создание Server Actions: `createRecipe`, `updateRecipe`, `deleteRecipe`, `getRecipes`.
    

### **2.5. Аналитика по Питанию (Новый раздел)**

- **[TODO]** Добавить вкладку "Аналитика" на страницу `/dashboard/nutrition`.
    
- **[TODO]** Разработка UI для визуализации:
    
    - **График 1: Динамика КБЖУ.** Линейный график, показывающий общее потребление калорий, белков, жиров и углеводов за выбранный период (неделя/месяц).
        
    - **График 2: Среднее по приемам пищи.** Круговая или столбчатая диаграмма, показывающая, какой прием пищи (завтрак, обед и т.д.) в среднем самый калорийный.
        
- **[TODO]** Создание Server Action (`getNutritionHistory`) для агрегации данных для графиков.
    

### **2.6. Виджеты и Счетчики на Дашборде (доработки)**

- **[DONE]** Создание Server Action (`getDailyNutritionSummary`) и виджета `NutritionSummaryWidget`.
    
- **[TODO]** Расширение `getDailyNutritionSummary` для расчета **кофеина** и **алкоголя**. Добавление их в виджет.
    
- **[TODO]** Реализация отдельного виджета и Server Action (`updateDailyWaterIntake`) для ручного ввода выпитой **воды**.
    

### **Этап 3: Вертикальный срез "Физическая Активность"**

#### **3.1. Ввод данных о Тренировках**

- **[TODO]** Добавление опции "Тренировка" в главное модальное окно.
    
- **[TODO]** Создание динамической UI-формы для записи тренировки:
    
    - Общие поля: Тип, Название, Продолжительность, RPE.
        
    - Условное поле "Дистанция" для типа "Кардио".
        
    - Условный вложенный блок для типа "Силовая" с возможностью динамически добавлять упражнения и подходы (название, повторы, вес).
        
- **[TODO]** Создание Server Action (`addWorkout`) для сохранения тренировки и всех ее вложенных подходов в таблицы `workouts` и `workout_sets`.
    

#### **3.2. Виджеты и Счетчики**

- **[TODO]** Создание виджета `WorkoutSummaryWidget` для дашборда, отображающего список тренировок за день.
    
- **[TODO]** Создание Server Action (`getDailyWorkouts`) для получения данных для виджета.
    
- **[TODO]** Реализация виджета и Server Action (`updateDailySteps`) для ручного ввода **количества шагов** за день.
    

### **Этап 4: Вертикальный срез "Сон и Субъективные Показатели"**

#### **4.1. Ввод и Отображение Данных о Сне**

- **[TODO]** Добавление опции "Сон" в главное модальное окно.
    
- **[TODO]** Создание UI-формы для ввода времени засыпания, пробуждения, оценки качества и заметок.
    
- **[TODO]** Создание Server Action (`addSleepLog`) для сохранения данных в `sleep_log`.
    
- **[TODO]** Создание виджета `SleepSummaryWidget` для дашборда с авторасчетом продолжительности и отображением оценки.
    
- **[TODO]** Создание Server Action (`getDailySleep`) для получения данных для виджета.
    

#### **4.2. Дневник Самочувствия**

- **[TODO]** Добавление опции "Самочувствие" в главное модальное окно.
    
- **[TODO]** Создание UI-формы для ежедневной сводки (энергия, настроение, стресс, пищеварение, заметки).
    
- **[TODO]** Создание Server Action (`updateDailySubjectiveMetrics`) для сохранения/обновления (UPSERT) данных в `daily_metrics`.
    
- **[TODO]** Создание виджета `WellbeingWidget` для отображения субъективных оценок на дашборде.
    

### **Этап 5: Вертикальный срез "Анализы и Добавки"**

#### **5.1. Трекер Добавок**

- **[TODO]** Создание UI-страницы (`/dashboard/supplements`) для управления **Справочником добавок** (CRUD).
    
- **[TODO]** Реализация UI для управления **Схемой приема** (какие добавки из справочника принимать, в каком количестве и когда).
    
- **[TODO] [DB]** Потребуется новая таблица `supplement_regimens` для хранения схемы.
    
- **[TODO]** Создание виджета `SupplementsChecklistWidget` на дашборде, который отображает схему приема на день в виде чек-листа.
    
- **[TODO]** Создание Server Action (`logSupplementIntake`) для записи факта приема в `supplement_log` при отметке чек-бокса.
    

#### **5.2. Журнал Анализов**

- **[TODO]** Добавление опции "Анализы" в главное модальное окно.
    
- **[TODO]** Создание UI-формы для создания "Отчета" (выбор даты) и динамического добавления "Результатов по маркерам" (название, значение, единицы, референсы).
    
- **[TODO]** Создание Server Action (`createLabReport`) для сохранения отчета и всех его результатов.
    
- **[TODO]** Создание UI-страницы (`/dashboard/lab-results`) для просмотра истории всех отчетов по анализам.
    

### **Этап 6: Вертикальный срез "Измерения Тела и Цели"**

#### **6.1. Журнал Измерений Тела**

- **[TODO]** Добавление опции "Измерения" в главное модальное окно.
    
- **[TODO]** Создание UI-формы для ввода веса и необязательных полей (жир, мышцы).
    
- **[TODO]** Создание Server Action (`addBodyMeasurement`).
    
- **[TODO]** Создание виджета `BodyWeightWidget` для дашборда, отображающего последнее значение веса и динамику.
    

#### **6.2. Управление Целями**

- **[TODO]** Создание UI-страницы (`/dashboard/goals`) для управления целями (CRUD).
    
- **[TODO]** Создание UI-формы для постановки цели (название, связанный показатель, значения, дата, статус).
    
- **[TODO]** Создание Server Actions для управления целями (`createGoal`, `updateGoal` и т.д.).
    
- **[TODO]** Создание виджета `GoalsWidget` для дашборда, который отображает активные цели и их текущий прогресс.
    
- **[TODO]** Реализация сложной логики на бэкенде для автоматического расчета прогресса по каждой цели.
    

### **Этап 7: Финализация Дашборда и Визуализации**

- **[TODO]** Создание страницы "История и Аналитика" (`/dashboard/history`).
    
- **[TODO]** Разработка UI на странице:
    
    - Выпадающий список для выбора любого отслеживаемого показателя в системе (Вес, Калории, Качество сна и т.д.).
        
    - Компонент для выбора периода времени (Date Range Picker).
        
- **[TODO]** Интеграция библиотеки `Recharts` для построения интерактивного графика.
    
- **[TODO]** Создание универсального Server Action (`getMetricHistory`) для извлечения данных для графика в зависимости от выбранного показателя и периода.
    
- **[TODO]** Отображение детальной таблицы с данными под графиком.
    

### **Этап 8: Системные функции и Полировка**

- **[TODO]** Создание страницы "Настройки" (`/dashboard/settings`).
    
- **[TODO]** Реализация функционала **Экспорта всех данных** в JSON на странице настроек.
    
- **[TODO]** Реализация формы для ввода данных профиля (рост, дата рождения) для расчета ИМТ и возраста.
    
- **[TODO]** Финальная полировка UI/UX:
    
    - Добавление состояний загрузки (loading spinners/skeletons).
        
    - Обработка ошибок и показ уведомлений (например, через `react-hot-toast`).
        
    - Создание "пустых состояний" (Empty States) для виджетов и страниц, когда данных еще нет.
        
    - Проверка и доработка адаптивности интерфейса.